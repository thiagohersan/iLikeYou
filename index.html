<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>iLoveYou (on Facebook)</title>
  <meta name="description" content="iLoveYou (on Facebook) is an app for letting someone know you love them (on Facebook).">
  <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css.css" />

  <meta property="og:title" content="iLoveYou (on Facebook)" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://www.thiagohersan.com/iLoveYou" />
  <meta property="og:image" content="http://www.thiagohersan.com/iLoveYou/imgs/heartssssss128.png" />
</head>
<body>
  <div id="fb-root"></div>
  <script>

  window.fbAsyncInit = function() {
    FB.init({
      appId      : '256150107871644',
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });

    FB.Event.subscribe('auth.authResponseChange', function(response) {
      if (response.status === 'connected') {
        onLogIn();
      }
    });
  };

  function centerVertical() {
    $("#main-body").css('height', $(window).height()+"px");
    $("#first-section").css('margin-top', ($(window).height() - $("#first-section").height())/2+"px");
  };

  var score, heartsPerRow;
  function addToScore(){
    if(score%heartsPerRow == 0){
      $("#score").append("<br>");
    }
    score++;

    if(((score>9) && (score%10 == 0)) || (Math.random() < 0.125)){
      $("#score").append("<img src=\"./imgs/heart.png\" width=\"20\" >");
    }
    else{
     $("#score").append("<img src=\"./imgs/like.png\" width=\"20\" >");
    }
    centerVertical();
  };

  $(window).load(function(){
                  centerVertical();
                  score = 0;
                  heartsPerRow = Math.floor($("#score").parent().width()/20);
                 });
  $(window).resize(centerVertical);
  $(window).click(addToScore);

  // Load the SDK asynchronously
  (function(d){
    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement('script'); js.id = id; js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js";
    ref.parentNode.insertBefore(js, ref);
  }(document));

  function logMeIn(){
    FB.login(function(response){},
             {scope: "user_likes,publish_actions,publish_stream,user_likes,friends_checkins,friends_events,friends_interests,friends_likes,friends_notes,friends_photos,friends_relationship_details,friends_status,friends_videos,read_stream"});
  }

  function onLogIn() {
      FB.ui({method: 'apprequests',
        message: 'Pick person to love',
        title: 'love',
        max_recipients: 1
      }, loveCallback);
  }

  function loveCallback(pickerResponse){
    for(var i=0; ('to' in pickerResponse)&&(i<pickerResponse.to.length); i++) {
      var loverId = pickerResponse.to[i];
      FB.api(loverId, function(response) {
        console.log("great, you picked: "+response.name+" ("+response.id+")");
      });

      // all posts
      FB.api(loverId+"/feed", { limit: 5000 }, function(allPosts) {
        console.log(allPosts.data.length+" posts");
        for(var i=0; i<allPosts.data.length; i++){
          FB.api(allPosts.data[i].id+"/likes", 'post', function(){});
        }
      });

      // all albums/photos
      FB.api(loverId+"/albums", { limit: 5000 }, function(allAlbums) {
        console.log(allAlbums.data.length+" albums");
        for(var i=0; i<allAlbums.data.length; i++){
          // iterate through pictures
          FB.api(allAlbums.data[i].id+"/photos", { limit: 5000 }, function(albumPhotos) {
            console.log("\t"+albumPhotos.data.length+" photos");
            for(var j=0; j<albumPhotos.data.length; j++){
              FB.api(albumPhotos.data[j].id+"/likes", 'post', function(){});
            }
          });
        }
      });

      // all tagged photos
      FB.api(loverId+"/photos", { limit: 5000 }, function(allPhotos) {
        console.log(allPhotos.data.length+" tagged photos");
        for(var i=0; i<allPhotos.data.length; i++){
          FB.api(allPhotos.data[i].id+"/likes", 'post', function(){});
        }
      });
    }
  }

  </script>

  <div id="main-body">
    <div class="content-center" id="first-section">
      <div id="title">
        iLoveYou (on Facebook)<br>
      </div>
      <div id="main-text">
        Love and affection at the edge of big data.<br>
      </div>
      <hr>
      <div id="poem-text">
        How do I love thee? Let me count the ways.<br>
        I love thee to the depth and breadth and height<br>
        My <a href="http://www.thiagohersan.com/iLoveYou/#" onclick="logMeIn()">browser</a> can reach, when feeling out of sight . . .<br>
      </div>
      <div id="score">
      </div>
    </div>
  </div>

  <div class="fb-like"
       id="fb-like"
       data-href="http://www.thiagohersan.com/iLoveYou"
       data-layout="box_count"
       data-action="like"
       data-show-faces="false"
       data-share="false">
  </div>

  <div id="info">
    <a href="http://www.thiagohersan.com/" target="_blank">Thiago Hersan</a>
  </div>

</body>
</html>
